<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ì‚¬íŒŒë¦¬ ìƒíƒœë°” ë° ë¸Œë¼ìš°ì € UI ìƒ‰ìƒ ì„¤ì • -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-navbutton-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    
    <title>ê¿ˆì—˜ì²­ ë³´ë“œê²Œì„ ë™ì•„ë¦¬</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ² ê¿ˆì—˜ì²­ ë³´ë“œê²Œì„ ë™ì•„ë¦¬</h1>
            <div class="header-info">
                <div class="header-controls">
                    <button id="authBtn" class="login-btn">ë¡œê·¸ì¸</button>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="search-box">
                <div class="search-main-group">
                    <div class="search-type-group">
                        <select id="searchType" aria-label="ê²€ìƒ‰ íƒ€ì…">
                            <option value="name">ê²Œì„ ì´ë¦„</option>
                            <option value="players">í”Œë ˆì´ ì¸ì›</option>
                            <option value="players-best">ë² ìŠ¤íŠ¸ ì¸ì›</option>
                            <option value="genre">ì¥ë¥´</option>
                        </select>
                    </div>
                    
                    <div class="search-input-group">
                        <input type="text" id="searchInput" placeholder="ê²Œì„ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰...">
                        <button onclick="searchAndFilter()" class="search-btn" title="ê²€ìƒ‰">ğŸ”</button>
                    </div>
                </div>
            </div>
            
            <div class="filter-box">
                
                <div class="filter-group">
                    <label>ë‚œì´ë„:</label>
                    <div class="slider-container">
                        <div class="slider-track">
                            <div class="slider-range" id="difficultyRange"></div>
                            <div class="slider-handle min-handle" id="difficultyMinHandle" data-slider="difficulty" data-type="min" role="slider" aria-label="ìµœì†Œ ë‚œì´ë„" aria-valuenow="1" aria-valuemin="1" aria-valuemax="3" tabindex="0"></div>
                            <div class="slider-handle max-handle" id="difficultyMaxHandle" data-slider="difficulty" data-type="max" role="slider" aria-label="ìµœëŒ€ ë‚œì´ë„" aria-valuenow="3" aria-valuemin="1" aria-valuemax="3" tabindex="0"></div>
                        </div>
                        <input type="range" id="difficultyMin" class="slider-input" min="1" max="3" value="1" step="0.1" aria-label="ìµœì†Œ ë‚œì´ë„" title="ìµœì†Œ ë‚œì´ë„">
                        <input type="range" id="difficultyMax" class="slider-input" min="1" max="3" value="3" step="0.1" aria-label="ìµœëŒ€ ë‚œì´ë„" title="ìµœëŒ€ ë‚œì´ë„">
                    </div>
                    <div class="slider-values">
                        <span id="difficultyMinValue">1.0</span>
                        <span id="difficultyMaxValue">3.0+</span>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label>í”Œë ˆì´ ì‹œê°„:</label>
                    <div class="slider-container">
                        <div class="slider-track">
                            <div class="slider-range" id="timeRange"></div>
                            <div class="slider-handle min-handle" id="timeMinHandle" data-slider="time" data-type="min" role="slider" aria-label="ìµœì†Œ í”Œë ˆì´ ì‹œê°„" aria-valuenow="10" aria-valuemin="10" aria-valuemax="120" tabindex="0"></div>
                            <div class="slider-handle max-handle" id="timeMaxHandle" data-slider="time" data-type="max" role="slider" aria-label="ìµœëŒ€ í”Œë ˆì´ ì‹œê°„" aria-valuenow="120" aria-valuemin="10" aria-valuemax="120" tabindex="0"></div>
                        </div>
                        <input type="range" id="timeMin" class="slider-input" min="10" max="120" value="10" step="5" aria-label="ìµœì†Œ í”Œë ˆì´ ì‹œê°„" title="ìµœì†Œ í”Œë ˆì´ ì‹œê°„">
                        <input type="range" id="timeMax" class="slider-input" min="10" max="120" value="120" step="5" aria-label="ìµœëŒ€ í”Œë ˆì´ ì‹œê°„" title="ìµœëŒ€ í”Œë ˆì´ ì‹œê°„">
                    </div>
                    <div class="slider-values">
                        <span id="timeMinValue">10ë¶„</span>
                        <span id="timeMaxValue">120ë¶„+</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê·¸ë¦¬ë“œ ë·° -->
        <div id="gridView" class="grid-container">
            <div class="grid-header">
                <div class="grid-header-left">
                    <h2>ë³´ë“œê²Œì„ ëª©ë¡</h2>
                    <div class="game-count" id="gameCount">ì´ 0ê°œ</div>
                </div>
                <div class="sort-controls">
                    <!-- ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ -->
                    <div class="custom-dropdown" id="customDropdown">
                        <div class="dropdown-selected" onclick="toggleDropdown()">
                            <span id="selectedOption">ê°€ë‚˜ë‹¤ìˆœ</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </div>
                        <div class="dropdown-options hidden" id="dropdownOptions">
                            <div class="dropdown-option" data-value="name" onclick="selectOption('name', 'ê°€ë‚˜ë‹¤ìˆœ')">ê°€ë‚˜ë‹¤ìˆœ</div>
                            <div class="dropdown-option" data-value="difficulty" onclick="selectOption('difficulty', 'ë‚œì´ë„ìˆœ')">ë‚œì´ë„ìˆœ</div>
                        </div>
                    </div>
                    
                    <button id="sortOrderBtn" onclick="toggleSortOrder()" class="sort-order-btn" title="ì •ë ¬ ìˆœì„œ ë³€ê²½" aria-label="ì •ë ¬ ìˆœì„œ í† ê¸€">
                        <span id="sortOrderIcon">â†‘</span>
                    </button>
                    
                    <button id="statusFilterBtn" onclick="toggleStatusFilter()" class="status-filter-btn" title="íŠ¹ë³„ ìƒíƒœ ê²Œì„ë§Œ ë³´ê¸°" aria-label="ìƒíƒœ í•„í„° í† ê¸€">
                        â—
                    </button>
                </div>
            </div>
            <div id="gameGrid" class="game-grid" role="grid" aria-label="ë³´ë“œê²Œì„ ëª©ë¡"></div>
        </div>

        <div class="loading" id="loading" aria-live="polite">
            <div class="spinner"></div>
            ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>

        <div class="error-message hidden" id="errorMessage" role="alert" aria-live="assertive">
            <span id="errorText"></span>
            <button onclick="hideError()">ë‹«ê¸°</button>
        </div>
    </div>

    <!-- ê²Œì„ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="game-detail-modal hidden" id="gameDetailModal" onclick="closeGameModal()" role="dialog" aria-modal="true" aria-labelledby="modalGameName">
        <div class="game-detail-content" onclick="event.stopPropagation()">
            <button id="modalCloseBtn" class="modal-close-btn" onclick="closeGameModal()" aria-label="ëª¨ë‹¬ ë‹«ê¸°">&times;</button>
            
            <div class="modal-game-image">
                <img id="modalGameImage" src="" alt="ê²Œì„ ì´ë¯¸ì§€">
            </div>
            
            <div class="game-detail-info">
                <!-- ë‚´ìš©ì€ JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
        </div>
    </div>

    <!-- ì‹¤ëª… ì…ë ¥ ëª¨ë‹¬ -->
    <div class="admin-password-modal hidden" id="realNameModal">
        <div class="admin-password-content" onclick="event.stopPropagation()">
            <div class="admin-password-header">
                <h2>ğŸ‘‹ í™˜ì˜í•©ë‹ˆë‹¤!</h2>
            </div>
            
            <div class="admin-password-body">
                <p>ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ ì‹¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <div class="password-input-group">
                    <input type="text" id="realNameInput" placeholder="ì‹¤ëª… ì…ë ¥ (í•œê¸€ 2-4ê¸€ì)" maxlength="4">
                    <button onclick="saveRealName()" class="verify-btn">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë§ˆì´í˜ì´ì§€ ëª¨ë‹¬ -->
    <div class="mypage-modal hidden" id="myPageModal" onclick="closeMyPage()">
        <div class="mypage-content" onclick="event.stopPropagation()">
            <div class="mypage-header">
                <h2>ğŸ‘¤ ë§ˆì´í˜ì´ì§€</h2>
                <button class="modal-close-btn" onclick="closeMyPage()" aria-label="ëª¨ë‹¬ ë‹«ê¸°">&times;</button>
            </div>
            
            <div class="mypage-body">
                <div class="user-info">
                    <h3 id="userRealName">ì‚¬ìš©ìëª…</h3>
                    <p id="userEmail">ì´ë©”ì¼</p>
                    <button onclick="signOut()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                
                <div class="mypage-actions">
                    <button onclick="openRentalModal()" class="action-btn rental-btn">ğŸ“‹ ëŒ€ì—¬ ì‹ ì²­</button>
                </div>
                
                <div class="user-rentals">
                    <h3>ë‚´ ëŒ€ì—¬ ê¸°ë¡</h3>
                    <div id="userRentalsList" class="rentals-list">
                        <!-- ëŒ€ì—¬ ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì—¬ ì‹ ì²­ ëª¨ë‹¬ -->
    <div class="rental-modal hidden" id="rentalModal" onclick="closeRentalModal()">
        <div class="rental-content" onclick="event.stopPropagation()">
            <div class="rental-header">
                <h2>ğŸ“‹ ëŒ€ì—¬ ì‹ ì²­</h2>
                <button class="modal-close-btn" onclick="closeRentalModal()" aria-label="ëª¨ë‹¬ ë‹«ê¸°">&times;</button>
            </div>
            
            <form id="rentalForm" class="rental-body">
                <div class="form-group">
                    <label for="gameSelect">ê²Œì„ ì„ íƒ</label>
                    <select id="gameSelect" required>
                        <option value="">ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="startDate">ì‹œì‘ì¼</label>
                        <input type="date" id="startDate" required onchange="updateEndDate()">
                    </div>
                    <div class="form-group">
                        <label for="endDate">ì¢…ë£Œì¼</label>
                        <input type="date" id="endDate" required>
                    </div>
                </div>
                
                <div class="rental-info">
                    <p>â€¢ ëŒ€ì—¬ ê¸°ê°„ì€ ìµœëŒ€ 8ì¼ì…ë‹ˆë‹¤.</p>
                    <p>â€¢ ìŠ¹ì¸ í›„ ì§ì ‘ ëŒ€ì—¬ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤.</p>
                    <p>â€¢ ë°˜ë‚©ë„ ì§ì ‘ ì²˜ë¦¬í•´ì£¼ì„¸ìš”.</p>
                </div>
            </form>
            
            <div class="rental-footer">
                <button type="button" onclick="closeRentalModal()" class="cancel-btn">ì·¨ì†Œ</button>
                <button type="button" onclick="submitRental()" class="submit-btn">ì‹ ì²­í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="firebase-auth.js"></script>
    <script type="module" src="rental-system.js"></script>
    <script src="script.js"></script>
    
    <script>
        // ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdownOptions');
            const arrow = document.querySelector('.dropdown-arrow');
            
            if (dropdown && arrow) {
                dropdown.classList.toggle('hidden');
                arrow.style.transform = dropdown.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
            }
        }
        
        // ê°œì„ ëœ ì •ë ¬ ì˜µì…˜ ì„ íƒ í•¨ìˆ˜
        function selectOption(value, text) {
            const selectedOption = document.getElementById('selectedOption');
            const dropdown = document.getElementById('dropdownOptions');
            const arrow = document.querySelector('.dropdown-arrow');
            
            // UI ì—…ë°ì´íŠ¸
            if (selectedOption) {
                selectedOption.textContent = text;
            }
            if (dropdown) {
                dropdown.classList.add('hidden');
            }
            if (arrow) {
                arrow.style.transform = 'rotate(0deg)';
            }
            
            // ë””ë²„ê¹… ë¡œê·¸ (ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©)
            console.log('ì •ë ¬ ê¸°ì¤€ ë³€ê²½:', value, 'â†’', text);
            
            // script.jsì˜ ì „ì—­ ë³€ìˆ˜ ë° í•¨ìˆ˜ í™•ì¸ í›„ ì—…ë°ì´íŠ¸
            if (typeof currentSortBy !== 'undefined') {
                currentSortBy = value;
                console.log('currentSortBy ì—…ë°ì´íŠ¸ë¨:', currentSortBy);
            }
            
            if (typeof window.currentSortBy !== 'undefined') {
                window.currentSortBy = value;
            }
            
            // ì •ë ¬ ì ìš© í•¨ìˆ˜ í˜¸ì¶œ
            if (typeof applySortingAndRender === 'function') {
                applySortingAndRender();
                console.log('ì •ë ¬ ì ìš© ì™„ë£Œ');
            } else if (typeof window.applySortingAndRender === 'function') {
                window.applySortingAndRender();
                console.log('ì •ë ¬ ì ìš© ì™„ë£Œ (window)');
            } else {
                console.error('applySortingAndRender í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì •ë ¬ ìˆœì„œ í† ê¸€ í•¨ìˆ˜
        function toggleSortOrder() {
            // script.jsì˜ ì „ì—­ ë³€ìˆ˜ë“¤ ì§ì ‘ ì¡°ì‘
            if (typeof currentSortOrder !== 'undefined') {
                currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
                console.log('ì •ë ¬ ìˆœì„œ ë³€ê²½:', currentSortOrder);
                
                // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                const sortOrderIcon = document.getElementById('sortOrderIcon');
                const sortOrderBtn = document.getElementById('sortOrderBtn');
                
                if (sortOrderIcon && sortOrderBtn) {
                    if (currentSortOrder === 'asc') {
                        sortOrderIcon.textContent = 'â†‘';
                        sortOrderBtn.title = 'ì˜¤ë¦„ì°¨ìˆœ â†’ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ë³€ê²½';
                    } else {
                        sortOrderIcon.textContent = 'â†“';
                        sortOrderBtn.title = 'ë‚´ë¦¼ì°¨ìˆœ â†’ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ë³€ê²½';
                    }
                }
                
                // ì •ë ¬ ì ìš©
                if (typeof applySortingAndRender === 'function') {
                    applySortingAndRender();
                } else if (typeof window.applySortingAndRender === 'function') {
                    window.applySortingAndRender();
                }
                
            } else {
                console.error('currentSortOrder ë³€ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('customDropdown');
            const dropdownOptions = document.getElementById('dropdownOptions');
            const arrow = document.querySelector('.dropdown-arrow');
            
            if (dropdown && !dropdown.contains(event.target)) {
                if (dropdownOptions) {
                    dropdownOptions.classList.add('hidden');
                }
                if (arrow) {
                    arrow.style.transform = 'rotate(0deg)';
                }
            }
        });
    </script>
</body>
</html>